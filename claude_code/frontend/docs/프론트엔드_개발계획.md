# 프론트엔드 개발 계획서

## 📋 목차
1. [디자인 vs 구현 비교 분석](#1-디자인-vs-구현-비교-분석)
2. [현재 구현 상태](#2-현재-구현-상태)
3. [미구현 기능 및 문제점](#3-미구현-기능-및-문제점)
4. [개발 우선순위](#4-개발-우선순위)
5. [단계별 개발 계획](#5-단계별-개발-계획)
6. [백엔드 API 연동 계획](#6-백엔드-api-연동-계획)

---

## 1. 디자인 vs 구현 비교 분석

### 1.1 Readdy 디자인 파일 분석

**플랫폼**: Web (React + Vite + TailwindCSS)  
**우리 프로젝트**: Mobile (React Native)

**Readdy 디자인에 포함된 페이지** (총 22개):

#### 인증 (3개)
- ✅ `/login` - 로그인 (이메일 기반)
- ✅ `/signup` - 회원가입
- ✅ `/account-recovery` - 계정 복구

#### 메인 기능 (4개)
- ✅ `/home` - 홈화면 (검사 입력)
- ✅ `/assessment` - 텍스트 검사
- ✅ `/assessment/voice` - 음성 검사
- ✅ `/result` - 검사 결과

#### 이력 & 알림 (3개)
- ✅ `/history` - 검사 이력
- ✅ `/notifications` - 알림 목록
- ❌ `/home/premium` - 프리미엄 홍보 (모바일 불필요)

#### 구독 & 결제 (3개)
- ✅ `/pricing` - 요금제
- ✅ `/pricing/subscription` - 구독 상세
- ✅ `/payment` - 결제
- ✅ `/payment-history` - 결제 이력

#### 설정 (6개)
- ✅ `/settings` - 설정 메인
- ✅ `/settings/language` - 언어 설정
- ✅ `/settings/theme` - 테마 설정
- ✅ `/settings/input-method` - 입력 방식 설정
- ✅ `/settings/notifications` - 알림 설정
- ❌ `/settings/usage-limit` - 사용량 제한 (readdy에 없음, 우리가 추가함)

#### 관리자 (3개)
- ✅ `/admin/login` - 관리자 로그인
- ✅ `/admin/dashboard` - 관리자 대시보드
- ✅ `/admin/notifications` - 관리자 알림 관리

---

### 1.2 주요 차이점

| 구분 | Readdy 디자인 | 우리 구현 | 비고 |
|------|---------------|-----------|------|
| **플랫폼** | Web | Mobile (React Native) | 네비게이션 구조 다름 |
| **인증 방식** | 이메일 기반 | 전화번호 기반 | 백엔드 User 엔티티 구조에 맞춤 |
| **홈화면** | 검사 입력 통합 | 검사 입력 통합 | ✅ 동일 |
| **상단 메뉴** | 아이콘 5개 | 아이콘 5개 | ✅ 동일 (설정, 결제, 알림, 이력, 로그아웃) |
| **맥박 측정** | 모달 팝업 | 모달 팝업 | ✅ 동일 |
| **검사 방식** | 텍스트/음성 전환 | 텍스트만 구현 | ❌ 음성 검사 미구현 |
| **구독 상태** | free/premium 구분 | 미구현 | ❌ 프리미엄 차단 로직 없음 |
| **Bottom Tab** | 없음 | 없음 | ✅ Top 아이콘으로 네비게이션 |

---

## 2. 현재 구현 상태

### 2.1 구현된 화면 (17개)

#### ✅ 인증 화면 (3개)
- `LoginScreen.tsx` - 로그인 (전화번호 기반으로 변경 필요)
- `SignupScreen.tsx` - 회원가입 (전화번호 기반으로 변경 필요)
- `AccountRecoveryScreen.tsx` - 계정 복구

#### ✅ 메인 화면 (3개)
- `HomeScreen.tsx` - 홈화면/검사 입력 (구현 완료, API 연동 필요)
- `ResultScreen.tsx` - 검사 결과
- `HistoryScreen.tsx` - 검사 이력

#### ✅ 구독/결제 화면 (3개)
- `PricingScreen.tsx` - 요금제
- `PaymentScreen.tsx` - 결제
- `PaymentHistoryScreen.tsx` - 결제 이력

#### ✅ 설정 화면 (6개)
- `SettingsScreen.tsx` - 설정 메인
- `LanguageSettingsScreen.tsx` - 언어 설정
- `ThemeSettingsScreen.tsx` - 테마 설정
- `InputMethodSettingsScreen.tsx` - 입력 방식 설정
- `NotificationSettingsScreen.tsx` - 알림 설정
- `UsageLimitScreen.tsx` - 사용량 제한 (디자인에 없음, 우리가 추가)

#### ✅ 관리자 화면 (3개)
- `AdminLoginScreen.tsx` - 관리자 로그인
- `AdminDashboardScreen.tsx` - 관리자 대시보드
- `AdminNotificationsScreen.tsx` - 관리자 알림 관리

### 2.2 네비게이션 구조

```typescript
// RootNavigator.tsx (TEMPORARY: HomeScreen 바로 표시)
<Stack.Navigator>
  <Stack.Screen name="Home" component={HomeScreen} />
</Stack.Navigator>

// 원래 구조 (주석 처리됨)
// {!isAuthenticated ? <AuthNavigator /> : <MainTabNavigator />}
```

**문제점**:
- 인증 체크 없이 홈화면으로 바로 이동
- Bottom Tab 없음 (Top 아이콘으로 네비게이션)
- 화면 전환 로직 미구현

---

## 3. 미구현 기능 및 문제점

### 3.1 인증 시스템 (Priority: 🔴 최우선)

#### 문제점
1. **로그인/회원가입이 이메일 기반**
   - Readdy 디자인: `email` + `password`
   - 백엔드 구현: `phone` + `password`
   - **해결 필요**: LoginRequest를 전화번호 기반으로 수정 완료 ✅
   - **프론트 수정 필요**: LoginScreen/SignupScreen을 전화번호 입력으로 변경

2. **인증 상태 관리 미구현**
   - `AuthContext` 또는 `authStore` 없음
   - JWT 토큰 저장/관리 로직 없음
   - 로그아웃 시 토큰 삭제 없음

3. **보호된 라우트 없음**
   - 인증 체크 없이 모든 화면 접근 가능
   - API 호출 시 Authorization 헤더 없음

### 3.2 API 연동 (Priority: 🔴 최우선)

#### 문제점
1. **API 클라이언트 없음**
   - axios 또는 fetch wrapper 미구현
   - BaseURL 설정 없음
   - Interceptor (토큰 자동 추가, 에러 처리) 없음

2. **HomeScreen API 연동 필요**
   ```typescript
   // 현재 (라인 82-88)
   const handleSubmit = () => {
     if (isFormValid()) {
       const bmi = calculateBMI();
       console.log('검사 완료:', {...data, bmi});  // ❌ 콘솔만 출력
       // TODO: Navigate to result screen
     }
   };
   
   // 필요한 구현
   const handleSubmit = async () => {
     if (isFormValid()) {
       try {
         // 1. 일일 사용량 확인
         const canUse = await checkDailyUsage(userId);
         if (!canUse) { /* 사용 제한 안내 */ }
         
         // 2. 검사 데이터 제출
         const checkResponse = await API.post('/api/checks', data);
         
         // 3. AI 진단 요청
         const predictionResponse = await API.post('/api/predictions', {
           checkId: checkResponse.data.checkId
         });
         
         // 4. 결과 화면으로 이동
         navigation.navigate('Result', { predictionId: predictionResponse.data.id });
       } catch (error) {
         Alert.alert('오류', '검사 중 오류가 발생했습니다.');
       }
     }
   };
   ```

3. **상단 아이콘 메뉴 미연결**
   - 설정, 결제, 알림, 이력 아이콘 클릭 시 API 호출 없음
   - 로그아웃 버튼 동작 없음

### 3.3 음성 검사 (Priority: 🟡 중요)

#### 문제점
- Readdy 디자인에는 `/assessment/voice` 페이지 있음
- 우리 프론트엔드에는 미구현
- OpenAI Realtime API 구현 계획서는 있음 (`/docs/gpt-realtime-mini_구현계획서.md`)

#### 필요 작업
1. VoiceAssessmentScreen.tsx 생성
2. OpenAI Realtime API 연동
3. WebSocket 연결 관리
4. 음성 입력 → 텍스트 변환 → 검사 데이터 매핑

### 3.4 구독 상태 관리 (Priority: 🟡 중요)

#### 문제점
1. **무료/유료 구분 없음**
   - Readdy 디자인: `subscriptionStatus` (free/premium)
   - 우리 구현: 미구현

2. **일일 사용 제한 없음**
   - 무료 사용자: 1회/일 제한 로직 없음
   - 프리미엄 화면 미표시

3. **구독 상태 확인 API 미호출**
   - `/api/v1/subscriptions/{userId}/active` 호출 없음

### 3.5 UI/UX 개선 (Priority: 🟢 권장)

#### 개선 필요 사항
1. **로딩 상태 표시**
   - API 호출 시 로딩 인디케이터 없음
   - 버튼 클릭 후 피드백 없음

2. **에러 처리**
   - API 에러 시 사용자 안내 메시지 없음
   - 네트워크 에러 처리 없음

3. **오프라인 지원**
   - 네트워크 없을 때 안내 없음
   - 데이터 캐싱 없음

4. **성능 최적화**
   - 이미지 최적화 없음
   - 리스트 가상화 없음

---

## 4. 개발 우선순위

### 🔴 Phase 1: 인증 시스템 및 API 연동 (1주)
**목표**: 로그인/회원가입 및 기본 API 연동 완료

1. **AuthContext/authStore 구현** (1일)
   - JWT 토큰 저장/관리
   - 로그인/로그아웃 로직
   - 인증 상태 전역 관리

2. **API 클라이언트 구현** (1일)
   - axios 설정 및 BaseURL
   - Interceptor (Authorization 헤더, 에러 처리)
   - API 함수 모듈화

3. **LoginScreen/SignupScreen 수정** (1일)
   - 이메일 → 전화번호 입력으로 변경
   - API 연동 (`/api/auth/login`, `/api/auth/register`)
   - 에러 처리 및 로딩 상태

4. **보호된 라우트 구현** (1일)
   - RootNavigator 수정 (인증 체크)
   - 토큰 만료 시 자동 로그아웃
   - 리프레시 토큰 자동 갱신

5. **HomeScreen API 연동** (2일)
   - 검사 데이터 제출 (`/api/checks`)
   - AI 진단 요청 (`/api/predictions`)
   - 일일 사용량 확인 (`/api/usage/{userId}/can-use`)
   - 결과 화면 네비게이션

### 🟡 Phase 2: 구독 및 결제 기능 (1주)

1. **구독 상태 관리** (2일)
   - 구독 상태 조회 API 연동
   - 무료/프리미엄 사용자 구분
   - 일일 사용 제한 로직

2. **PricingScreen 연동** (1일)
   - 구독 플랜 조회 API
   - 플랜 선택 및 결제 연동

3. **PaymentScreen 연동** (2일)
   - Google Play Store / Apple App Store 인앱 결제
   - 결제 검증 API 연동
   - 결제 성공/실패 처리

4. **PaymentHistoryScreen 연동** (1일)
   - 결제 이력 조회 API
   - 환불 처리

### 🟡 Phase 3: 이력 및 알림 기능 (3일)

1. **HistoryScreen 연동** (1일)
   - 검사 이력 조회 API
   - 이전 결과 재조회

2. **NotificationsScreen 연동** (1일)
   - 알림 목록 조회 API
   - 읽음/삭제 처리

3. **ResultScreen 연동** (1일)
   - 진단 결과 상세 조회
   - 재검사 권장 로직

### 🟢 Phase 4: 음성 검사 (2주)

1. **VoiceAssessmentScreen 구현** (3일)
   - 화면 레이아웃 및 UI
   - 마이크 권한 요청
   - 음성 녹음 기능

2. **OpenAI Realtime API 연동** (5일)
   - WebSocket 연결 관리
   - 음성 스트리밍
   - 응답 처리

3. **음성 → 검사 데이터 매핑** (2일)
   - AI 응답 파싱
   - 검사 데이터 구조로 변환

4. **텍스트/음성 전환** (1일)
   - 검사 진행 중 모드 전환
   - 데이터 동기화

### 🟢 Phase 5: 설정 및 기타 (3일)

1. **설정 화면 API 연동** (1일)
   - 사용자 설정 조회/업데이트
   - 언어, 테마, 알림 설정

2. **관리자 화면 연동** (2일)
   - 관리자 대시보드 데이터
   - 사용자 관리 API

### 🟢 Phase 6: UI/UX 개선 및 최적화 (1주)

1. **로딩 상태 및 에러 처리** (2일)
2. **성능 최적화** (2일)
3. **오프라인 지원** (1일)
4. **접근성 개선** (1일)
5. **테스트 작성** (1일)

---

## 5. 단계별 개발 계획

### Phase 1 (Week 1): 인증 & 기본 API 연동

#### Day 1-2: 인프라 구축
```typescript
// src/store/authStore.ts
import AsyncStorage from '@react-native-async-storage/async-storage';
import {create} from 'zustand';

interface AuthStore {
  accessToken: string | null;
  refreshToken: string | null;
  user: User | null;
  login: (phone: string, password: string) => Promise<void>;
  logout: () => Promise<void>;
  refreshAccessToken: () => Promise<void>;
}

// src/services/api.ts
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:8080/api',
  timeout: 10000,
});

// Request Interceptor
api.interceptors.request.use(async (config) => {
  const token = await AsyncStorage.getItem('accessToken');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Response Interceptor
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      // 토큰 만료 시 자동 갱신
      await refreshToken();
    }
    return Promise.reject(error);
  }
);
```

#### Day 3: LoginScreen 수정
```typescript
// src/screens/auth/LoginScreen.tsx
const [formData, setFormData] = useState({
  phone: '',      // email → phone 변경
  password: ''
});

const handleSubmit = async () => {
  try {
    setIsLoading(true);
    await authStore.login(formData.phone, formData.password);
    navigation.replace('Home');
  } catch (error) {
    Alert.alert('로그인 실패', '전화번호 또는 비밀번호를 확인해주세요.');
  } finally {
    setIsLoading(false);
  }
};
```

#### Day 4: RootNavigator 수정
```typescript
// src/navigation/RootNavigator.tsx
const RootNavigator = () => {
  const {isAuthenticated, isLoading} = useAuthStore();

  if (isLoading) {
    return <SplashScreen />;
  }

  return (
    <NavigationContainer>
      {!isAuthenticated ? <AuthNavigator /> : <MainNavigator />}
    </NavigationContainer>
  );
};
```

#### Day 5-6: HomeScreen API 연동
```typescript
// src/screens/main/HomeScreen.tsx
const handleSubmit = async () => {
  if (!isFormValid()) return;

  try {
    setIsLoading(true);

    // 1. 일일 사용량 확인
    const usageResponse = await API.get(`/api/usage/${userId}/can-use`);
    if (!usageResponse.data.canUse) {
      Alert.alert('사용 제한', '오늘의 검사 횟수를 모두 사용했습니다.');
      navigation.navigate('Pricing');
      return;
    }

    // 2. 검사 데이터 제출
    const checkResponse = await API.post('/api/checks', {
      userId,
      ...data,
      bmi: calculateBMI(),
    });

    // 3. AI 진단 요청
    const predictionResponse = await API.post('/api/predictions', {
      checkId: checkResponse.data.checkId,
    });

    // 4. 결과 화면으로 이동
    navigation.navigate('Result', {
      predictionId: predictionResponse.data.id,
    });
  } catch (error) {
    Alert.alert('오류', '검사 중 오류가 발생했습니다.');
  } finally {
    setIsLoading(false);
  }
};
```

---

## 6. 백엔드 API 연동 계획

### 6.1 인증 API

| API | 메서드 | 용도 | 화면 |
|-----|--------|------|------|
| `/api/auth/login` | POST | 로그인 | LoginScreen |
| `/api/auth/register` | POST | 회원가입 | SignupScreen |
| `/api/auth/logout` | POST | 로그아웃 | 모든 화면 |
| `/api/auth/refresh` | POST | 토큰 갱신 | API Interceptor |
| `/api/auth/me` | GET | 현재 사용자 정보 | 모든 화면 |

### 6.2 검사 API

| API | 메서드 | 용도 | 화면 |
|-----|--------|------|------|
| `/api/checks` | POST | 검사 생성 | HomeScreen |
| `/api/checks/{userId}` | GET | 이력 조회 | HistoryScreen |
| `/api/checks/{checkId}` | GET | 검사 상세 | ResultScreen |

### 6.3 진단 API

| API | 메서드 | 용도 | 화면 |
|-----|--------|------|------|
| `/api/predictions` | POST | 진단 생성 | HomeScreen |
| `/api/predictions/{id}` | GET | 진단 상세 | ResultScreen |

### 6.4 사용량 API

| API | 메서드 | 용도 | 화면 |
|-----|--------|------|------|
| `/api/usage/{userId}/can-use` | GET | 사용 가능 여부 | HomeScreen |
| `/api/usage/{userId}` | GET | 사용량 조회 | UsageLimitScreen |

### 6.5 구독 API

| API | 메서드 | 용도 | 화면 |
|-----|--------|------|------|
| `/api/v1/subscriptions/{userId}/active` | GET | 활성 구독 조회 | HomeScreen, PricingScreen |
| `/api/v1/subscriptions` | POST | 구독 생성 | PaymentScreen |

### 6.6 결제 API

| API | 메서드 | 용도 | 화면 |
|-----|--------|------|------|
| `/api/v1/payments` | POST | 결제 생성 | PaymentScreen |
| `/api/v1/payments/{userId}` | GET | 결제 이력 | PaymentHistoryScreen |

### 6.7 알림 API

| API | 메서드 | 용도 | 화면 |
|-----|--------|------|------|
| `/api/v1/notifications/{userId}` | GET | 알림 목록 | NotificationsScreen |
| `/api/v1/notifications/{userId}/unread/count` | GET | 읽지 않은 알림 개수 | HomeScreen (상단 아이콘) |
| `/api/v1/notifications/{notificationId}/read` | PUT | 읽음 처리 | NotificationsScreen |

### 6.8 설정 API

| API | 메서드 | 용도 | 화면 |
|-----|--------|------|------|
| `/api/v1/settings/{userId}` | GET | 설정 조회 | SettingsScreen |
| `/api/v1/settings/{userId}` | PUT | 설정 업데이트 | 설정 화면들 |

---

## 7. 개발 시작 전 체크리스트

### 환경 설정
- [ ] `.env` 파일 생성 및 API BaseURL 설정
- [ ] AsyncStorage 라이브러리 설치
- [ ] axios 라이브러리 설치
- [ ] zustand (상태 관리) 라이브러리 설치

### 코드 구조
- [ ] `src/store/` 디렉토리 생성 (상태 관리)
- [ ] `src/services/` 디렉토리 생성 (API 클라이언트)
- [ ] `src/types/` 디렉토리 생성 (TypeScript 타입)
- [ ] `src/constants/` 디렉토리 생성 (상수)
- [ ] `src/utils/` 디렉토리 생성 (유틸리티 함수)

### 네비게이션
- [ ] AuthNavigator 구현
- [ ] MainNavigator 구현
- [ ] RootNavigator 인증 체크 로직 추가

---

## 8. 예상 일정

| Phase | 기간 | 주요 작업 |
|-------|------|-----------|
| Phase 1 | 1주 | 인증 시스템 & 기본 API 연동 |
| Phase 2 | 1주 | 구독 및 결제 기능 |
| Phase 3 | 3일 | 이력 및 알림 기능 |
| Phase 4 | 2주 | 음성 검사 (OpenAI Realtime API) |
| Phase 5 | 3일 | 설정 및 관리자 기능 |
| Phase 6 | 1주 | UI/UX 개선 및 최적화 |
| **총** | **5.5주** | **MVP 완성** |

---

## 9. 리스크 및 대응 방안

### 리스크 1: 백엔드 API 미완성
- **현황**: 인증 API는 구현됨 ✅
- **리스크**: AI 모델 API 미구현
- **대응**: Phase 1에서 Mock Data로 개발, 백엔드 완성 후 연동

### 리스크 2: OpenAI Realtime API 복잡도
- **리스크**: WebSocket 연결, 음성 스트리밍 처리 복잡
- **대응**: Phase 4를 별도 2주 할당, 필요 시 Phase 5 이후로 연기

### 리스크 3: 인앱 결제 구현
- **리스크**: Google Play / Apple App Store 연동 복잡
- **대응**: Phase 2에서 결제 테스트 환경 먼저 구축

---

## 10. 다음 단계

**✅ 즉시 시작 가능한 작업 (Phase 1):**

1. **AuthStore 구현** (`src/store/authStore.ts`)
2. **API 클라이언트 구현** (`src/services/api.ts`)
3. **LoginScreen 수정** (전화번호 입력으로 변경)
4. **RootNavigator 인증 체크 추가**
5. **HomeScreen API 연동** (검사 제출 → 결과)

**문서 작성 완료**: 2024-10-28  
**작성자**: Claude Code  
**버전**: 1.0
